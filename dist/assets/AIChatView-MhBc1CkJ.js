import{J as s,U as z,j as e,L as B,V as S,X as G}from"./index-B22AmSHL.js";const F=()=>{const[d,c]=s.useState([]),[x,p]=s.useState(""),[i,k]=s.useState(!1),[o,A]=s.useState(!1),[m,g]=s.useState(""),[f,b]=s.useState(!1),[M,R]=s.useState(""),[C,$]=s.useState(0),u=s.useRef(null),y=3,I=9999,E=!1,L=t=>{const a=((t==null?void 0:t.message)||JSON.stringify(t)||"").toLowerCase();return a.includes("quota")||a.includes("resource_exhausted")||a.includes("rate limit")||a.includes("429")};s.useEffect(()=>{u.current&&(u.current.scrollTop=u.current.scrollHeight)},[d,i]),s.useEffect(()=>{b(!!z())},[]);const _=()=>{const t=m.trim();t&&(S(t),g(""),b(!0))},D=()=>{S(null),g(""),b(!1)},K=async(t,a)=>{t==null||t.preventDefault();const w=(a??x).trim();if(!w||i||o)return;const v=w;p("");const P={role:"user",text:v,timestamp:new Date},l=[...d,P];c(l),k(!0);try{let r=M,n=C;const T=Math.max(0,l.length-y)-n,N=E&&T>=I,U=Math.max(N?n:0,l.length-y),H=l.slice(U,l.length-1).map(h=>({role:h.role,text:h.text})),q={role:"ai",text:await G(v,"BDS",void 0,{summary:r,recentMessages:H}),timestamp:new Date};c(h=>[...h,q])}catch(r){if(console.error("AI Error:",r),L(r))A(!0),c(n=>[...n,{role:"ai",text:"Daily quota reached for this model. Please try again after the quota resets.",timestamp:new Date}]);else{const n=r.message||JSON.stringify(r);console.error("Full AI Error:",r),c(j=>[...j,{role:"ai",text:`I encountered an error: **"${n}"**. 

**Possible fix:** If you are the admin, please ensure the \`OPENAI_API_KEY\` is correctly set in Cloudflare Settings -> Functions -> Environment Variables.`,timestamp:new Date}])}}finally{k(!1)}};return e.jsxs("div",{className:"max-w-5xl mx-auto h-[calc(100vh-12rem)] flex flex-col glass-panel rounded-[2rem] overflow-hidden bg-white/60 dark:bg-slate-900/40",children:[e.jsx("div",{className:"border-b border-slate-200 dark:border-white/5 px-8 py-5 flex items-center justify-between bg-slate-50/80 dark:bg-slate-900/50",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-cyan-600 to-blue-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-cyan-900/50",children:e.jsx("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-slate-900 dark:text-white text-lg",children:"DentEdge AI Tutor"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"flex h-2 w-2 relative",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-green-500"})]}),e.jsx("span",{className:"text-[11px] text-slate-500 dark:text-slate-400 font-bold uppercase tracking-wider",children:"Active Learning Session"})]})]})]})}),e.jsxs("div",{ref:u,className:"flex-1 overflow-y-auto p-8 space-y-8 bg-slate-50/50 dark:bg-slate-950/30",children:[d.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center max-w-lg mx-auto space-y-8",children:[e.jsx("div",{className:"w-24 h-24 bg-slate-200 dark:bg-slate-800 rounded-full flex items-center justify-center text-cyan-600 dark:text-cyan-500 relative ring-1 ring-slate-300 dark:ring-white/10",children:e.jsx("svg",{className:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-3",children:"Welcome to your Personal Clinic."}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-lg leading-relaxed",children:"I am trained in clinical medicine and medical education. How can I help clarify your studies today?"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 w-full",children:["Explain Heart Failure types","Cushing vs Addison Disease","Differential for Hematuria","MOA of Statins"].map(t=>e.jsx("button",{onClick:()=>{p(t)},className:"text-left p-4 text-sm font-medium bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-white/5 rounded-2xl hover:border-cyan-500/50 hover:text-cyan-600 dark:hover:text-cyan-400 text-slate-600 dark:text-slate-300 transition-all shadow-sm hover:shadow-md",children:t},t))})]}):d.map((t,a)=>e.jsx("div",{className:`flex ${t.role==="user"?"justify-end":"justify-start"} animate-in fade-in slide-in-from-bottom-3 duration-500`,children:e.jsxs("div",{className:`max-w-[85%] flex flex-col ${t.role==="user"?"items-end":"items-start"}`,children:[e.jsx("div",{className:`px-6 py-4 rounded-3xl leading-relaxed ${t.role==="user"?"bg-cyan-600 text-white rounded-tr-none shadow-[0_0_20px_rgba(8,145,178,0.3)] text-sm font-medium":"bg-white dark:bg-slate-800 text-slate-800 dark:text-slate-200 shadow-sm border border-slate-200 dark:border-white/5 rounded-tl-none medical-serif text-base"}`,children:t.role==="ai"?e.jsx("div",{className:"prose prose-sm max-w-none prose-p:leading-relaxed prose-headings:text-slate-900 dark:prose-headings:text-white prose-strong:text-cyan-600 dark:prose-strong:text-cyan-400 prose-slate dark:prose-invert",children:e.jsx(B,{children:t.text})}):e.jsx("div",{className:"whitespace-pre-wrap",children:t.text})}),e.jsx("span",{className:"text-[10px] text-slate-400 dark:text-slate-500 mt-2 font-bold px-2 uppercase tracking-widest",children:t.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},a)),i&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 px-6 py-5 rounded-3xl shadow-sm border border-slate-200 dark:border-white/5 rounded-tl-none flex items-center gap-4",children:[e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 bg-cyan-500 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2.5 h-2.5 bg-cyan-500 rounded-full animate-bounce [animation-delay:0.2s]"}),e.jsx("div",{className:"w-2.5 h-2.5 bg-cyan-500 rounded-full animate-bounce [animation-delay:0.4s]"})]}),e.jsx("span",{className:"text-xs font-bold text-slate-400 dark:text-slate-500 uppercase tracking-[0.2em]",children:"Consulting Textbook..."})]})})]}),e.jsxs("div",{className:"p-6 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-white/5",children:[e.jsxs("details",{className:"mb-3 group",children:[e.jsxs("summary",{className:"text-xs font-semibold text-slate-600 dark:text-slate-300 cursor-pointer select-none",children:["Use your own Gemini API key ",f?"(saved)":""]}),e.jsxs("div",{className:"mt-2 flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{type:"password",value:m,onChange:t=>g(t.target.value),placeholder:f?"Paste a new key to replace":"Paste Gemini API key",className:"flex-1 bg-slate-100 dark:bg-slate-950 border border-slate-200 dark:border-white/5 rounded-xl px-4 py-2 text-sm text-slate-900 dark:text-white placeholder:text-slate-500 focus:ring-1 focus:ring-cyan-500/50 outline-none transition-all"}),e.jsx("button",{type:"button",onClick:_,disabled:!m.trim(),className:`px-4 py-2 rounded-xl text-sm font-semibold transition-all ${m.trim()?"bg-cyan-600 text-white hover:bg-cyan-500":"bg-slate-200 text-slate-500 dark:bg-slate-800 dark:text-slate-400"}`,children:"Save"}),f&&e.jsx("button",{type:"button",onClick:D,className:"px-4 py-2 rounded-xl text-sm font-semibold bg-slate-200 text-slate-700 dark:bg-slate-800 dark:text-slate-300 hover:bg-slate-300 dark:hover:bg-slate-700 transition-all",children:"Clear"})]}),e.jsx("div",{className:"text-[10px] text-slate-500 dark:text-slate-400 mt-2",children:"How to get a free key:"}),e.jsx("div",{className:"text-[10px] text-slate-500 dark:text-slate-400",children:"1. Open Google AI Studio and create an API key."}),e.jsx("div",{className:"text-[10px] text-slate-500 dark:text-slate-400",children:"2. Copy the key and paste it here."}),e.jsx("div",{className:"text-[10px] text-slate-500 dark:text-slate-400",children:"3. Click Save. Key stays in your browser only."})]}),o&&e.jsx("div",{className:"mb-3 text-xs font-semibold text-amber-700 bg-amber-100/80 dark:text-amber-300 dark:bg-amber-900/40 px-4 py-2 rounded-xl",children:"Daily quota reached. Try again after the quota resets."}),e.jsxs("form",{onSubmit:K,className:"relative flex items-center gap-3 max-w-4xl mx-auto",children:[e.jsx("input",{type:"text",value:x,onChange:t=>p(t.target.value),disabled:o,placeholder:"Ask a question about physiology, pathology, or clinical cases...",className:"flex-1 bg-slate-100 dark:bg-slate-950 border border-slate-200 dark:border-white/5 rounded-2xl px-8 py-5 text-slate-900 dark:text-white placeholder:text-slate-500 focus:ring-1 focus:ring-cyan-500/50 outline-none transition-all pr-20 text-base"}),e.jsx("button",{type:"submit",disabled:!x.trim()||i||o,className:`absolute right-2.5 p-3 rounded-xl transition-all ${!x.trim()||i||o?"text-slate-400 dark:text-slate-600":"bg-cyan-600 text-white shadow-[0_0_15px_rgba(6,182,212,0.4)] hover:bg-cyan-500 active:scale-90"}`,children:e.jsx("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})})]})]})]})};export{F as default};
