import{J as r,W as M,j as e,X as R,L as U,N as B,Y as G,_ as Y}from"./index-D0Thyyap.js";const F=s=>{const a=[];return(s.toLowerCase().includes("mechanism")||s.toLowerCase().includes("pathway"))&&a.push("What are the clinical implications of this mechanism?"),(s.toLowerCase().includes("treatment")||s.toLowerCase().includes("therapy"))&&a.push("What are the contraindications or side effects?"),(s.toLowerCase().includes("disease")||s.toLowerCase().includes("condition"))&&a.push("How is this diagnosed in clinical practice?"),(s.toLowerCase().includes("drug")||s.toLowerCase().includes("medication"))&&a.push("How does this drug interact with other medications?"),a.length===0&&a.push("Can you explain that in more detail?"),s.match(/(?:regarding|about|concerning)\s+([^.!?]+)/i)?a.push("What's the differential diagnosis for this?"):a.push("How is this tested in exams?"),[...new Set(a)].slice(0,3)},K=()=>{const[s,a]=r.useState([]),[d,p]=r.useState(""),[c,w]=r.useState(!1),[x,S]=r.useState(!1),[C,$]=r.useState(""),[L,V]=r.useState(0),[E,y]=r.useState(!1),[f,A]=r.useState(()=>typeof window<"u"?localStorage.getItem("selectedAIModel")||M:M),u=r.useRef(null),b=3,I=9999,T=!1,_=t=>{const n=((t==null?void 0:t.message)||JSON.stringify(t)||"").toLowerCase();return n.includes("quota")||n.includes("resource_exhausted")||n.includes("rate limit")||n.includes("429")},P=t=>{A(t),typeof window<"u"&&localStorage.setItem("selectedAIModel",t)};r.useEffect(()=>{u.current&&(u.current.scrollTop=u.current.scrollHeight)},[s,c]);const k=async(t,n)=>{t==null||t.preventDefault();const h=(n??d).trim();if(!h||c||x)return;const m=h;p("");const D={role:"user",text:m,timestamp:new Date},o=[...s,D];a(o),w(!0);try{let l=C,i=L;const H=Math.max(0,o.length-b)-i,j=T&&H>=I,W=Math.max(j?i:0,o.length-b),z=o.slice(W,o.length-1).map(g=>({role:g.role,text:g.text})),N=await Y(m,"Public",void 0,{summary:l,recentMessages:z},f),O=F(N),Q={role:"ai",text:N,timestamp:new Date,suggestedQuestions:O};a(g=>[...g,Q])}catch(l){if(console.error("AI Error:",l),_(l))S(!0),a(i=>[...i,{role:"ai",text:`âš ï¸ **Daily limit reached** - You've hit the daily token limit for this model tier.

**Premium Models** (GPT-5.2, GPT-4o, GPT-4 Turbo): 250K tokens/day (shared)

**Standard Models** (GPT-4o Mini, GPT-3.5 Turbo): 2.5M tokens/day (shared)

Please try again after midnight UTC when the quota resets.`,timestamp:new Date}]);else{const i=l.message||JSON.stringify(l);console.error("Full AI Error:",l),a(v=>[...v,{role:"ai",text:`I encountered an error: **"${i}"**.

**Fix:** Do not use a browser-exposed \`VITE_OPENAI_API_KEY\` (it will be leaked/blocked). In Cloudflare **Pages**: open your project â†’ **Settings â†’ Environment variables** â†’ add the server-side secret \`OPENAI_API_KEY\` (Production, and Preview if needed), then redeploy. The app calls the \`/api/openai\` proxy.`,timestamp:new Date}])}}finally{w(!1)}};return e.jsxs("div",{className:"max-w-5xl mx-auto h-[calc(100vh-12rem)] flex flex-col glass-panel rounded-[2rem] overflow-hidden bg-white/60 dark:bg-slate-900/40",children:[e.jsxs("div",{className:"border-b border-slate-200 dark:border-white/5 px-8 py-5 flex items-center justify-between bg-slate-50/80 dark:bg-slate-900/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-cyan-600 to-blue-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-cyan-900/50",children:e.jsx("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-slate-900 dark:text-white text-lg",children:"DentEdge AI Tutor"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"flex h-2 w-2 relative",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-green-500"})]}),e.jsx("span",{className:"text-[11px] text-slate-500 dark:text-slate-400 font-bold uppercase tracking-wider",children:"Active Learning Session"})]})]})]}),e.jsxs("button",{onClick:()=>y(!0),className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-white dark:bg-slate-800 border border-slate-200 dark:border-white/5 hover:border-cyan-500/50 dark:hover:border-cyan-500/50 transition-colors group",title:"Select AI Model",children:[e.jsx("svg",{className:"w-4 h-4 text-slate-600 dark:text-slate-400 group-hover:text-cyan-600 dark:group-hover:text-cyan-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),e.jsx("span",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300 group-hover:text-cyan-600 dark:group-hover:text-cyan-400",children:R(f)})]})]}),e.jsxs("div",{ref:u,className:"flex-1 overflow-y-auto p-8 space-y-8 bg-slate-50/50 dark:bg-slate-950/30",children:[s.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center max-w-lg mx-auto space-y-8",children:[e.jsx("div",{className:"w-24 h-24 bg-slate-200 dark:bg-slate-800 rounded-full flex items-center justify-center text-cyan-600 dark:text-cyan-500 relative ring-1 ring-slate-300 dark:ring-white/10",children:e.jsx("svg",{className:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-3",children:"Welcome to your Personal Clinic."}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-lg leading-relaxed",children:"I am trained in clinical medicine and medical education. How can I help clarify your studies today?"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 w-full",children:["Explain Heart Failure types","Cushing vs Addison Disease","Differential for Hematuria","MOA of Statins"].map(t=>e.jsx("button",{onClick:()=>{p(t)},className:"text-left p-4 text-sm font-medium bg-white dark:bg-slate-800/50 border border-slate-200 dark:border-white/5 rounded-2xl hover:border-cyan-500/50 hover:text-cyan-600 dark:hover:text-cyan-400 text-slate-600 dark:text-slate-300 transition-all shadow-sm hover:shadow-md",children:t},t))})]}):s.map((t,n)=>e.jsx("div",{children:e.jsx("div",{className:`flex ${t.role==="user"?"justify-end":"justify-start"} animate-in fade-in slide-in-from-bottom-3 duration-500`,children:e.jsxs("div",{className:`max-w-[85%] flex flex-col ${t.role==="user"?"items-end":"items-start"}`,children:[e.jsx("div",{className:`px-6 py-4 rounded-3xl leading-relaxed ${t.role==="user"?"bg-cyan-600 text-white rounded-tr-none shadow-[0_0_20px_rgba(8,145,178,0.3)] text-sm font-medium":"bg-white dark:bg-slate-800 text-slate-800 dark:text-slate-200 shadow-sm border border-slate-200 dark:border-white/5 rounded-tl-none medical-serif text-base"}`,children:t.role==="ai"?e.jsx("div",{className:"prose prose-sm max-w-none prose-p:leading-relaxed prose-headings:text-slate-900 dark:prose-headings:text-white prose-strong:text-cyan-600 dark:prose-strong:text-cyan-400 prose-slate dark:prose-invert",children:e.jsx(U,{components:{a:B},children:t.text})}):e.jsx("div",{className:"whitespace-pre-wrap",children:t.text})}),e.jsx("span",{className:"text-[10px] text-slate-400 dark:text-slate-500 mt-2 font-bold px-2 uppercase tracking-widest",children:t.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),t.role==="ai"&&t.suggestedQuestions&&t.suggestedQuestions.length>0&&e.jsx("div",{className:"mt-4 flex flex-col gap-2 w-full max-w-md",children:t.suggestedQuestions.map((h,m)=>e.jsxs("button",{onClick:()=>k(void 0,h),className:"text-left px-4 py-3 text-xs font-semibold bg-cyan-50 dark:bg-cyan-900/20 border border-cyan-200 dark:border-cyan-800 rounded-2xl text-cyan-700 dark:text-cyan-300 hover:bg-cyan-100 dark:hover:bg-cyan-900/40 transition-colors",children:["ðŸ’¡ ",h]},m))})]})})},n)),c&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 px-6 py-5 rounded-3xl shadow-sm border border-slate-200 dark:border-white/5 rounded-tl-none flex items-center gap-4",children:[e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 bg-cyan-500 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2.5 h-2.5 bg-cyan-500 rounded-full animate-bounce [animation-delay:0.2s]"}),e.jsx("div",{className:"w-2.5 h-2.5 bg-cyan-500 rounded-full animate-bounce [animation-delay:0.4s]"})]}),e.jsx("span",{className:"text-xs font-bold text-slate-400 dark:text-slate-500 uppercase tracking-[0.2em]",children:"Consulting Textbook..."})]})})]}),e.jsxs("div",{className:"p-6 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-white/5",children:[x&&e.jsx("div",{className:"mb-3 text-xs font-semibold text-red-700 bg-red-100/80 dark:text-red-300 dark:bg-red-900/40 px-4 py-3 rounded-xl border border-red-300 dark:border-red-700",children:"âš ï¸ Daily limit reached for this model tier. Resets at midnight UTC."}),e.jsxs("form",{onSubmit:k,className:"relative flex items-center gap-3 max-w-4xl mx-auto",children:[e.jsx("input",{type:"text",value:d,onChange:t=>p(t.target.value),disabled:x,placeholder:"Ask a question about physiology, pathology, or clinical cases...",className:"flex-1 bg-slate-100 dark:bg-slate-950 border border-slate-200 dark:border-white/5 rounded-2xl px-8 py-5 text-slate-900 dark:text-white placeholder:text-slate-500 focus:ring-1 focus:ring-cyan-500/50 outline-none transition-all pr-20 text-base"}),e.jsx("button",{type:"submit",disabled:!d.trim()||c||x,className:`absolute right-2.5 p-3 rounded-xl transition-all ${!d.trim()||c||x?"text-slate-400 dark:text-slate-600":"bg-cyan-600 text-white shadow-[0_0_15px_rgba(6,182,212,0.4)] hover:bg-cyan-500 active:scale-90"}`,children:e.jsx("svg",{className:"w-7 h-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})})]})]}),e.jsx(G,{currentModel:f,onModelChange:P,isOpen:E,onClose:()=>y(!1)})]})};export{K as default};
